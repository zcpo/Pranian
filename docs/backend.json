{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the Pranian application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        },
        "subscriptionId": {
          "type": "string",
          "description": "Reference to Subscription. (Relationship: User 1:1 Subscription)"
        }
      },
      "required": [
        "id",
        "email"
      ]
    },
    "Subscription": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Subscription",
      "type": "object",
      "description": "Represents a user's subscription status and details.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subscription."
        },
        "startDate": {
          "type": "string",
          "description": "The date and time the subscription started.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "The date and time the subscription ends.",
          "format": "date-time"
        },
        "subscriptionTierId": {
          "type": "string",
          "description": "Reference to SubscriptionTier. (Relationship: Subscription 1:1 SubscriptionTier)"
        },
        "isTrial": {
          "type": "boolean",
          "description": "Indicates if the current subscription is a free trial."
        }
      },
      "required": [
        "id",
        "startDate",
        "endDate",
        "subscriptionTierId",
        "isTrial"
      ]
    },
    "SubscriptionTier": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SubscriptionTier",
      "type": "object",
      "description": "Represents the different subscription tiers available (e.g., Free Trial, Paid).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the subscription tier."
        },
        "name": {
          "type": "string",
          "description": "Name of the subscription tier (e.g., Free Trial, Paid)."
        },
        "price": {
          "type": "number",
          "description": "Price of the subscription tier per month.",
          "format": "number"
        },
        "trialLengthDays": {
          "type": "number",
          "description": "The trial period in days."
        }
      },
      "required": [
        "id",
        "name",
        "price"
      ]
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product sold in the Pranian store.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "productCategoryId": {
          "type": "string",
          "description": "Reference to ProductCategory. (Relationship: Product 1:1 ProductCategory)"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "productCategoryId"
      ]
    },
    "ProductCategory": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ProductCategory",
      "type": "object",
      "description": "Represents a category of products (e.g., Podcasts, Merchandise, Events, Books, Videos, Online Learning).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product category."
        },
        "name": {
          "type": "string",
          "description": "Name of the product category."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Content": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Content",
      "type": "object",
      "description": "Represents a piece of yoga or meditation content in the library.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the content."
        },
        "title": {
          "type": "string",
          "description": "Title of the content."
        },
        "description": {
          "type": "string",
          "description": "Description of the content."
        },
        "contentTypeId": {
          "type": "string",
          "description": "Reference to ContentType. (Relationship: Content 1:1 ContentType)"
        },
        "url": {
          "type": "string",
          "description": "URL of the content.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "contentTypeId",
        "url"
      ]
    },
    "ContentType": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ContentType",
      "type": "object",
      "description": "Represents the type of content (e.g., Article, Video, Audio).",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the content type."
        },
        "name": {
          "type": "string",
          "description": "Name of the content type."
        }
      },
      "required": [
        "id",
        "name"
      ]
    },
    "Session": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Session",
      "type": "object",
      "description": "Represents a user's yoga or meditation session.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the session."
        },
        "date": {
          "type": "string",
          "description": "The date and time the session occurred.",
          "format": "date-time"
        },
        "duration": {
          "type": "number",
          "description": "The duration of the session in minutes."
        },
        "intensity": {
          "type": "number",
          "description": "The user-rated intensity of the session (1-5)."
        }
      },
      "required": [
        "id",
        "date",
        "duration"
      ]
    },
    "FeedItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "FeedItem",
      "type": "object",
      "description": "Represents an item in the user's social feed.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the feed item."
        },
        "title": {
          "type": "string",
          "description": "Title of the feed item."
        },
        "subtitle": {
          "type": "string",
          "description": "Subtitle or content of the feed item."
        },
        "image": {
          "type": "string",
          "description": "URL of an image associated with the feed item.",
          "format": "uri"
        },
        "userId": {
          "type": "string",
          "description": "ID of the user who created the feed item."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp when the feed item was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "userId",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information.  Uses path-based ownership for private user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user.  Corresponds to Firebase auth uid."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/subscriptions/{subscriptionId}",
        "definition": {
          "entityName": "Subscription",
          "schema": {
            "$ref": "#/backend/entities/Subscription"
          },
          "description": "Stores subscription details for each user. Uses path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "subscriptionId",
              "description": "The unique identifier for the user's subscription."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/sessions/{sessionId}",
        "definition": {
          "entityName": "Session",
          "schema": {
            "$ref": "#/backend/entities/Session"
          },
          "description": "Stores session analytics data for each user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "sessionId",
              "description": "The unique identifier for the user's session."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/feed_items/{itemId}",
        "definition": {
          "entityName": "FeedItem",
          "schema": {
            "$ref": "#/backend/entities/FeedItem"
          },
          "description": "Stores feed items created by a specific user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "itemId",
              "description": "The unique identifier for the feed item."
            }
          ]
        }
      },
      {
        "path": "/subscriptionTiers/{subscriptionTierId}",
        "definition": {
          "entityName": "SubscriptionTier",
          "schema": {
            "$ref": "#/backend/entities/SubscriptionTier"
          },
          "description": "Stores different subscription tiers available (e.g., Free Trial, Paid).",
          "params": [
            {
              "name": "subscriptionTierId",
              "description": "The unique identifier for the subscription tier."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information for the e-commerce store.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/productCategories/{productCategoryId}",
        "definition": {
          "entityName": "ProductCategory",
          "schema": {
            "$ref": "#/backend/entities/ProductCategory"
          },
          "description": "Stores product categories (e.g., Podcasts, Merchandise, Events).",
          "params": [
            {
              "name": "productCategoryId",
              "description": "The unique identifier for the product category."
            }
          ]
        }
      },
      {
        "path": "/content/{contentId}",
        "definition": {
          "entityName": "Content",
          "schema": {
            "$ref": "#/backend/entities/Content"
          },
          "description": "Stores yoga and meditation content. Includes denormalized 'subscriptionTierId' field for authorization independence.",
          "params": [
            {
              "name": "contentId",
              "description": "The unique identifier for the content."
            }
          ]
        }
      },
      {
        "path": "/contentTypes/{contentTypeId}",
        "definition": {
          "entityName": "ContentType",
          "schema": {
            "$ref": "#/backend/entities/ContentType"
          },
          "description": "Stores content types (e.g., Article, Video, Audio).",
          "params": [
            {
              "name": "contentTypeId",
              "description": "The unique identifier for the content type."
            }
          ]
        }
      }
    ],
    "reasoning": "This Firestore structure is designed to support the Pranian application's core features, including content library, free tier trial, subscription management, and e-commerce store, while adhering to the principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), QAPs (Queries are not Filters), and Invariants. The structure leverages structural segregation to maintain homogeneous security postures within collections, avoiding the mixing of data with differing access requirements. Authorization independence is achieved through denormalization, copying relevant authorization data (such as subscription status) where needed to eliminate the need for `get()` calls in security rules, ensuring atomic operations and simplified debugging.  \n\nThe structure employs path-based ownership for user-specific data (e.g., `/users/{userId}/subscriptions/{subscriptionId}`).\n\n**Authorization Independence:** Denormalization is applied to the `Content` documents. The `Subscription.subscriptionTierId` is copied into the content document via `content.subscriptionTierId` during creation. \n\n**QAPs (Queries are not Filters):** The structure enables secure list operations:\n*   The segregation of user data under `/users/{userId}` ensures that listing operations within a user's scope are always authorized by path-based rules.\n*   The denormalized `content.subscriptionTierId` field allows listing content that matches the users current subscription tier."
  }
}
    