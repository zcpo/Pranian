
rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // --- USERS ---
    match /users/{userId} {
      allow read: if request.auth != null;
      allow write: if request.auth.uid == userId
                   || request.auth.token.role == "super_admin";

      match /followers/{followerId} {
        allow read: if request.auth != null;
      }
      match /following/{followingId} {
        allow read: if request.auth != null;
      }
    }

    // --- PAGES ---
    match /pages/{pageId} {
      allow read: if true;
      allow write: if request.auth.token.role == "super_admin";
    }

    // --- YOGA SECTIONS ---
    match /yoga_sections/{sectionId} {
      allow read: if true;
      allow write: if request.auth.token.role == "super_admin";
    }

    // --- LIBRARY CONTENT ---
    match /library_content/{contentId} {
      allow read: if true;
      allow write: if request.auth.token.role in ["admin", "super_admin"];
    }

    // --- STORE ---
    match /store_items/{itemId} {
      allow read: if true;
      allow write: if request.auth.token.role == "super_admin";
    }

    // --- EVENTS ---
    match /events/{eventId} {
      allow read: if true;
      allow write: if request.auth.token.role == "super_admin";
    }

    // --- JOURNALS ---
    match /journals/{userId}/{entryId} {
      allow read, write: if request.auth.uid == userId;
    }

    // --- POSTS ---
    match /posts/{postId} {
      allow read: if true;
      allow write: if request.auth != null;
      allow delete: if request.auth.token.role == "super_admin";
    }
  }
}
